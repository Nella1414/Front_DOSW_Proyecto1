import{b as n,t as a}from"./index-BozS7dwg.js";import{u as E,t as A,a as L,b as i,c as T,d as U,e as c}from"./useQuery-BCrtMYGT.js";import{u as D}from"./QueryClientProvider-C9Cpl-59.js";import{u as O,d as b,s as P,l as M}from"./useMutation-D7hWThM1.js";import{m as j}from"./student-registration-B-iTyGcQ.js";import{i as q}from"./chunk-SSA7SXE4-L4GPux4n.js";import{c as z}from"./chunk-XJ2YRSUP-CDLwH12k.js";import{b as f}from"./chunk-WBUKVQRU-D83Npybh.js";const g=[{label:"Estudiante",value:"STUDENT"},{label:"Decanatura",value:"DEAN"},{label:"Administrador",value:"ADMIN"}],p=r=>{const l=g.find(s=>s.value===r);return l?l.label:r};function J(){const[r,l]=n.useState(""),[s,d]=n.useState(""),[u,N]=n.useState(null),[m,_]=n.useState(""),v=D(),{data:y=[],isLoading:w}=E({queryKey:["users"],queryFn:async()=>(await new Promise(e=>setTimeout(e,500)),j)}),t=O({mutationFn:async({userId:e,role:o})=>{await new Promise(h=>setTimeout(h,1e3));const x=j.find(h=>h.id===e);if(!x)throw new Error("Usuario no encontrado");return console.log("Sending to backend:",{userId:e,role:o}),{name:x.name,role:o}},onSuccess:e=>{N({user:e.name,role:p(e.role)}),v.invalidateQueries({queryKey:["users"]}),l(""),d("")}}),C=y.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase())),R=e=>{switch(e){case"ADMIN":case"administrador":return"danger";case"DEAN":case"decanatura":return"warning";case"STUDENT":case"estudiante":return"primary";default:return"default"}},S=()=>{r&&s&&t.mutate({userId:r,role:s})};return a.jsxs("div",{className:"space-y-6",children:[u&&a.jsxs(b,{color:"success",title:"Rol actualizado exitosamente",children:["Usuario: ",u.user," | Nuevo rol: ",u.role]}),a.jsx("div",{className:"flex gap-4 items-end",children:a.jsx(q,{label:"Buscar usuario",placeholder:"Nombre o correo...",value:m,onChange:e=>_(e.target.value),className:"flex-1"})}),a.jsxs(A,{"aria-label":"Tabla de usuarios",children:[a.jsxs(L,{children:[a.jsx(i,{children:"NOMBRE"}),a.jsx(i,{children:"CORREO"}),a.jsx(i,{children:"ROL ACTUAL"}),a.jsx(i,{children:"ACCIONES"})]}),a.jsx(T,{isLoading:w,children:C.map(e=>a.jsxs(U,{children:[a.jsx(c,{children:e.name}),a.jsx(c,{children:e.email}),a.jsx(c,{children:a.jsx(z,{color:R(e.role),variant:"flat",children:p(e.role)})}),a.jsx(c,{children:a.jsx(f,{size:"sm",variant:"light",onPress:()=>l(e.id),children:"Cambiar rol"})})]},e.id))})]}),r&&a.jsxs("div",{className:"bg-default-50 p-4 rounded-lg space-y-4",children:[a.jsx("h3",{className:"font-semibold",children:"Asignar nuevo rol"}),a.jsxs("div",{className:"flex gap-4 items-end",children:[a.jsx(P,{label:"Nuevo rol",placeholder:"Selecciona un rol",selectedKeys:s?[s]:[],onSelectionChange:e=>{const o=Array.from(e)[0];d(o)},className:"flex-1",children:g.map(e=>a.jsx(M,{children:e.label},e.value))}),a.jsx(f,{color:"primary",onPress:S,isLoading:t.isPending,isDisabled:!s,children:"Asignar"}),a.jsx(f,{variant:"light",onPress:()=>{l(""),d("")},children:"Cancelar"})]})]}),t.error&&a.jsx(b,{color:"danger",title:"Error al actualizar rol",children:t.error.message})]})}export{J as R};
